.. _whatsnew_100b4:

1.0.0b4 (???)
-------------

This is the fourth 1.0 beta release.


API Changes
~~~~~~~~~~~
* :py:mod:`solarforecastarbiter.metrics.prepocessing.apply_validation` now expects a single observation DataFrame with value and quality_flag columns instead of a dict. It also returns the processed Series along with a dict of the number of values removed for each quality flag. (:pull:`291`)
* :py:mod:`solarforecastarbiter.metrics.prepocessing.resample_and_align` now expects the forecast and observation series explicitly. It also returns the resample and aligned values instead of a `datamodel.ProcessedForecastObservation` (:pull:`291`)
* Move functionality of :py:mod:`solarforecastarbiter.reports.main.validate_resample_align` to :py:mod:`solarforecastarbiter.metrics.prepocessing.process_forecast_observations` (:pull:`291`)
* Rename `io.utils.serialize_data` to :py:mod:`solarforecastarbiter.io.utils.serialize_timeseries` (:pull:`291`)
* :py:mod:`solarforecastarbiter.metrics.calculator.calculate_metrics` returns a list of `~datamodel.MetridResult` and :py:mod:`solarforecastarbiter.metrics.calculator.calculate_deterministic_metrics` returns a single `~datamodel.MetricResult` (:pull:`291`)
* :py:mod:`solarforecastarbiter.datamodel.ProcessedForecastObservation` now requires a name parameter (:pull:`291`)
* :py:func:`solarforecastarbiter.reports.figures.construct_timeseries_cds` now takes a single :py:class:`solarforecastarbiter.datamodel.Report` object and returns separate Bokeh ColumnDataSources for
timeseries and metadata.
* :py:func:`solarforecastarbiter.reports.figures.construct_metrics_cds` updated to accept a list of :py:class:`solarforecastarbiter.datamodel.MetricResults` as its first argument.
* :py:func:`solarforecastarbiter.reports.figures.timeseries` and :py:func:`solarforecastarbiter.figures.scatter` now take two Bokeh ColumnDataSources as their first two arguments in place of a list of (ProcesseForecastObservation, ColumnDataSource) tuples. See the return value of :py:func:`solarforecastarbiter.figures.construct_timeseries_cds` for the format of these ColumnDataSources.
* Replaced `solarforecastarbiter.reports.full_html` with :py:func:`solarforecastarbiter.reports.template.render_html` which accepts a :py:class:`solarforecastarbiter.datamodel.Report` object, a dashboard url and optional flags to include timeseries plots or generate a standalone html report.
* Add :py:func:`solarforecastarbiter.reports.figures.output_svg` to save Bokeh figures as SVG
* Add optional status keyword to :py:func:`solarforecastarbiter.io.api.APISession.post_raw_report`
* :py:mod:`solarforecastarbiter.datamodel.PreprocessingResult` Added to track prepocessing summary of results (:pull:`320`)

Enhancements
~~~~~~~~~~~~
* Automatically verify selected metrics are valid for deterministic forecasts. (:issue:`267`) (:pull:`301`)
* Automatically verify selected metrics are valid for probabilistic forecasts. (:issue:`302`) (:pull:`306`)
* Add schema for de/serializing timeseries in :py:mod:`solarforecastarbiter.io.utils` (:pull:`291`)
* Add decorator factory :py:func:`solarforecastarbiter.reports.main.capture_report_failure` to better log report failures to the end user.
* Add missing tests for functionality in :py:mod:`solarforecastarbiter.reports.main` (:issue:`312`)
* Add missing tests for :py:mod:`solarforecastarbiter.reports.figures`
* Add data validation summary table in the html report (:issue:`299`) (:pull:`320`)
* Track data preprocessing results add section and summary table in the html report (:issue:`299`) (:pull:`320`)

Bug fixes
~~~~~~~~~
* Fix handling of empty observation timeseries in metrics preprocessing. (:issue:`295`) (:pull:`296`)
* Fix handling of `interval_label == ending` in the `groupby` categories in
  `metrics.calculator`. (:issue:`234`) (:pull:`297`)
* Document `resample_and_align()` behavior when the `interval_label` of the
  forecast and observation don't match. (:issue:`300`) (:pull:`303`)
* Fix scatter plot limits when some data is NaN (:issue:`282`)
* Handle errors on SVG export (:issue:`310`)
* Test and handle errors in report creation for empty data (:issue:`217`)
* Fix :py:func:`solarforecastarbiter.datamodel.__check_units__` with no arguments

Contributors
~~~~~~~~~~~~

* Will Holmgren (:ghuser:`wholmgren`)
* Leland Boeman (:ghuser:`lboeman`)
* Cliff Hansen (:ghuser:`cwhanse`)
* Tony Lorenzo (:ghuser:`alorenzo175`)
* Justin Sharp (:ghuser:`MrWindAndSolar`)
* Aidan Tuohy
* Adam Wigington (:ghuser:`awig`)
* David Larson (:ghuser:`dplarson`)
